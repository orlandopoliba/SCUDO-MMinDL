<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>06-multiclass_logistic_regression.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>Multiclass Logistic Regression</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/index-DFrkvKWf.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/preload-helper-D2MJg03u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/clsx-D8GwTfvk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/cn-BKtXLv3a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/react-Bj1aDYRI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/compiler-runtime-B3qBwwSJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/jsx-runtime-ZmTK25f3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/badge-DX6CQ6PA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/hotkeys-BHHWjLlp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useEventListener-Cb-RVVEn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/button-CZ3Cs4qb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/react-dom-CSu739Rf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/Combination-BAEdC-rz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/menu-items-BMjcEb2j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-DwV58Fb1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/createLucideIcon-BCdY6lG5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/check-Dr3SxUsb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/x-ZP5cObgf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/select-BVdzZKAh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/tooltip-CMQz28hC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/use-toast-BDYuj3zG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_baseIsEqual-B9N9Mw_N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useEvent-BhXAndur.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/invariant-CAG_dYON.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_baseFor-Duhs3RiJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/merge-BBX6ug-N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/zod-H_cgTO0M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/utils-YqBXNpsM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/Deferred-DxQeE5uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/uuid-DXdzqzcr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/DeferredRequestRegistry-CMf25YiV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/constants-B6Cb__3x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/session-BOFn9QrD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/config-Q0O7_stz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/requests-B4FYHTZl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_hasUnicode-CWqKLxBC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/assertNever-CBU83Y6o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_arrayReduce-TT0iOGKY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useLifecycle-ClI_npeg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useNonce-CS26E0hA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useTheme-DQozhcp1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/once-Bul8mtFs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/capabilities-MM7JYRxj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/createReducer-B3rBsy4P.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/paths-BzSgteR-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-DBwNzi3C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-ChS0Dc_R.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-CtsanegT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-Dcqqg9UU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-sMh6mJ2d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-Btv5Rh1v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-bBwmhqty.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-CoCQUAeM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-Gqv0jSNr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/stex-jWatZkll.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/toDate-DETS9bBd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/cjs-CH5Rj0g8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_baseProperty-NKyJO2oh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/now-6sUe0ZdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/debounce-B3mjKxHe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/toInteger-CDcO32Gx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/database-zap-k4ePIFAU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/main-U5Goe76G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/cells-DPp5cDaO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/spinner-DA8-7wQv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/chevron-right--18M_6o9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dropdown-menu-ldcmQvIV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/kbd-Cm6Ba9qg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/renderShortcut-BckyRbYt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/multi-map-DxdLNTBd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/alert-BOoN6gJ1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/card-OlSjYhmd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/alert-dialog-BW4srmS0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dialog-eb-NieZw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dist-CDXJRSCj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/label-E64zk6_7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useDebounce-7iEVSqwM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/textarea-CRI7xDBj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/numbers-D7O23mOZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/SSRProvider-BIDQNg9Q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/context-BfYAMNLF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useNumberFormatter-Db6Vjve5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/usePress-C__vuri5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/input-DUrq2DiR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/links-7AQBmdyV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/popover-CH1FzjxU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/switch-dWLWbbtg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/table-DScsXgJW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/mode-Bn7pdJvO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useAsyncData-BMGLSTg8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/errors-TZBmrJmc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/error-banner-B9ts0mNl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/copy-DHrHayPa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/memoize-BCOZVFBt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/get-6uJrSKbw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/capitalize-CmNnkG9y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/copy-D-8y6iMN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/plus-B7DF33lD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/refresh-cw-Dx8TEWFP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/trash-2-DDsWrxuJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/triangle-alert-CebQ7XwA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/ai-model-dropdown-Dk2SdB3C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/defaultLocale-JieDVWC_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/precisionRound-CU2C3Vxx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/defaultLocale-BLne0bXb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/vega-loader.browser-DXARUlxo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/tooltip-DxKBXCGp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/ErrorBoundary-B9Ifj8Jf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useInstallPackage-D4fX0Ee_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/ImperativeModal-BNN1HA7x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/cell-link-B9b7J8QK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/datasource-CtyqtITR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/state-D4T75eZb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/MarimoErrorOutput-Lf9P8Fhl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/copy-icon-v8ME_JKB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/html-to-image-CIQqSu-S.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/focus-C1YokgL7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/LazyAnyLanguageCodeMirror-DgZ8iknE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/chunk-5FQGJX7Z-DPlx2kjA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/katex-CDLTCvjQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/markdown-renderer-DJy8ww5d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/command-2ElA5IkO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/download-os8QlW6l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useRunCells-D2HBb4DB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/purify.es-DZrAQFIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/RenderHTML-D-of_-s7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useIframeCapabilities-B_pQb20b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/formats-CobRswjh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/en-US-CCVfmA-q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/isValid-DDt9wNjK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/dates-CrvjILe3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/maps-D2_Mq1pZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/extends-BiFDv3jB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/emotion-is-prop-valid.esm-C59xfSYt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useDateFormatter-CqhdUl2n.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/range-D2UKkEg-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/table-CfDbAm78.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/JsonOutput-PE5ko4gi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useDeleteCell-DdRX94yC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/icons-CCHmxi8d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/process-output-ByfLnk6j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/blob-D-eV0cU3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/objectWithoutPropertiesLoose-DfWeGRFv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/esm-Bmu2DhPy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/file-Ch78NKWp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/play-GLWQQs7F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/add-cell-with-ai-e_HMl7UU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/isEmpty-CgX_-6Mt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/bot-message-square-B2ThzDUZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/chat-display--jAB7huF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/chart-no-axes-column-qvVRjhv1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/square-function-B6mgCeFJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/spec-Ch0xnJY4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/column-preview-CXjSXUhP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/toggle-zVW4FXNz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/globals-BgACvYmr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/share-ipf2hrOh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_baseSet-5Rdwpmr3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/react-resizable-panels.browser.esm-Da3ksQXL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/utilities.esm-MA1QpjVT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/floating-outline-BtdqbkUq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useAddCell-CmuX2hOk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/eye-off-AK_9uodG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/readonly-python-code-WjTf6Pdd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/file-video-camera-C3wGzBnE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/types-BRfQN3HL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/refresh-ccw-DN_xCV6A.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/form-BidPUZUn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/field-CySaBlkz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useBoolean-Ck_unDZw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/useDeepCompareMemoize-5OUgerQ3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/types-C1UhS3qM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/prop-types-DaaA-ptl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/es-BYgU_srD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/hasIn-CycJImp8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/_baseFlatten-CUZNxU8H.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/flatten-D-7VEN0q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/pick-B_6Qi5aM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/code-xml-CgN_Yig7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/download-Dg7clfkc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/square-CuJ72M8f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/settings-OBbrbhij.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/bundle.esm-i_UbZC0w.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/cells-jmgGt1lS.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/markdown-renderer-DdDKmWlR.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/JsonOutput-B7vuddcd.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.8/dist/assets/index-CeUwN_0i.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
<style title='marimo-custom'>.marimo-output .markdown,
.markdown {
  font-size: 18px;
  line-height: 1.6;
}
</style></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "06-multiclass_logistic_regression.py",
            "mode": "read",
            "version": "0.19.8",
            "serverToken": "static",
            "config": {"ai": {"custom_providers": {}, "models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false, "signature_hint_on_typing": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 18, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": true, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_csv_encoding": "utf-8", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"app_title": "Multiclass Logistic Regression", "auto_download": ["html"], "css_file": "style.css", "sql_output": "auto", "width": "columns"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": 0, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\n# Logistic regression (multiclass classification) with MNIST\n\nWe use now multiclass logistic regression to recognize the digit.\n\"\"\")", "code_hash": "6bfe5be746aa4aaa8879e48064a1d30e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Preparing the dataset\n\nThe first part of this notebook is the same as the one to prepare the data in the [previous notebook](03-binary_logistic_regression.py). Look that for more details.\n\"\"\")", "code_hash": "afe07c9f4aebcd1460c8f4365f92009d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "import pandas as pd\nimport torch\nimport matplotlib.pyplot as plt", "code_hash": "7dfed8ac5f388270761870b0fb53f597", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "from pathlib import Path\n\nBASE_DIR = Path(__file__).resolve().parent.parent\n\ndata_path = BASE_DIR / 'datasets' / 'mnist_train.csv'\nmnist_train = pd.read_csv(data_path)\ndata_path = BASE_DIR / 'datasets' / 'mnist_test.csv'\nmnist_test = pd.read_csv(data_path)", "code_hash": "13882a28341082b2248f6b668903800f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "mnist_train", "code_hash": "ee72c95ebb744f8917375d5c9d9ee7a3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "mnist_test", "code_hash": "895a5079e3ea871b8b9776258137226e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "mo.md(r\"\"\"\nBefore defining our target, we modify the target tensors in a convenient way. This will be also useful for the next notebook on multi-class classification. The original tensors contain the labels indicating the digit.\n\"\"\")", "code_hash": "7de7c73c31fb8fc2e072b03a79f7dacf", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe labels are just words that we use to identify the digits and they only represent the class where the items in the dataset belong to. The numerical values of the labels are not relevant for the classification task. A way to represent classes numerically is to use *one-hot encoding*.\n\nOne-hot encoding works as follows. Assume you have $K$ classes. We can enumerate the classes $\\{0,1,2,\\dots, K-1\\}$. We represent each class as a vector in a $K$ dimensional space. More precisely, each class is a coordinate direction in the $K$ dimensional space. This is implemented as follows: We define the bijection\n\n$$\nk \\in \\{0,1,2,\\dots, K-1\\} \\mapsto \\begin{pmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ 1 \\\\ 0 \\\\ \\vdots \\\\ 0 \\end{pmatrix} \\in \\mathbb{R}^K,\n$$\n\nwhere the $1$ is in the $k$-th position (counting from $0$ to $K-1$).\n\"\"\")", "code_hash": "6eb23b8890991cda2bb08083c65b8635", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet us implement this in Python. We use a matrix trick to do this.\n\nThe `torch.eye` function creates an identity matrix.\n\"\"\")", "code_hash": "b900004c686b6b207ed960d264ef4e6c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RGSE", "name": "_"}, {"code": "torch.eye(10)", "code_hash": "33ffbe2f094fdec31f5281e9131b4c62", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe one-hot encoding of $k$ is obtained by simply extracting the $k$-th column (or row) of the identity matrix.\n\"\"\")", "code_hash": "4c0387456563b191e0034c2f7f5c3e92", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "emfo", "name": "_"}, {"code": "torch.eye(10)[2]", "code_hash": "2f7cbb6c5387d66d287253299caa0d24", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe reshape the tensor so that it is a column vector. The function `one_hot_encode` also works on many labels at once.\n\"\"\")", "code_hash": "43ee735854a0d4d8a2ab691c92e3e6b4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nWHF", "name": "_"}, {"code": "def one_hot_encode(y, num_classes):\n    n_samples = y.shape[0]\n    return torch.eye(num_classes)[y].view(n_samples, num_classes)", "code_hash": "69fbb06a6db7d625ba4f1347843076e5", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "y_train_one_hot = one_hot_encode(y_train_raw, 10)\ny_test_one_hot = one_hot_encode(y_test_raw, 10)", "code_hash": "08746bc001f334a4c4eafe56aea4d041", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet us see some examples.\n\"\"\")", "code_hash": "b5fc00cf29d8a3b4108d42c43e40fb4e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "for _i in range(7):\n  print(f\"Label: {y_train_raw[_i,:].item()} | One-hot encoding: {y_train_one_hot[_i,:]}\")", "code_hash": "9cc9e96ca31eae9f0a387cf65c1e6f00", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "x_train_raw = torch.tensor(mnist_train.iloc[:, 1:].values, dtype=torch.float32)\nx_test_raw = torch.tensor(mnist_test.iloc[:, 1:].values, dtype=torch.float32)\n\nx_train = x_train_raw / 255 \nx_test = x_test_raw / 255\n\ny_train_raw = torch.tensor(mnist_train.iloc[:,0].values, dtype=torch.int64).view(-1,1)\ny_test_raw = torch.tensor(mnist_test.iloc[:,0].values, dtype=torch.int64).view(-1,1)\n\ny_train = one_hot_encode(y_train_raw, 10)\ny_test = one_hot_encode(y_test_raw, 10)", "code_hash": "475d06eae83ae403ab134724a784b4dc", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "n_training_samples = x_train.shape[0]\nn_test_samples = x_test.shape[0]\nn_features = x_train.shape[1]\nn_classes = y_train.shape[1]\nn_classes, n_features, n_training_samples, n_test_samples", "code_hash": "14f9d194e93ecf08fcd1333b23d19409", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "def _plot():\n\n    # sample plot of the data\n    n_sample = 10\n    fig = plt.figure(figsize=(n_sample, 3))\n    axs = []\n    for i in range(n_sample):\n      axs.append(fig.add_subplot(1, n_sample, i+1))\n      axs[i].imshow(x_train[i,:].view(28,28), cmap='gray_r')\n      axs[i].set_title(f'{(y_train[i,:]==1).nonzero().item():.0f} ')\n      axs[i].axis('off')\n    plt.show()\n\n_plot()", "code_hash": "e10e1ad1714ad9b47df59ffcff931385", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "", "code_hash": null, "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Multiclass logistic regression\n\nWe recall how multiclass logistic regression works. We have some data $\\{(x_i, y_i)\\}_{i=0, \\ldots, N-1}$ where $x_i \\in \\mathbb{R}^{1\\times M}$ and $y_i \\in \\{0, 1, \\ldots, K-1\\}$. The data are thought as realizations of a random sample $(X_0, Y_0), \\ldots, (X_{N-1}, Y_{N-1})$ drawn from a certain distribution. We make the *ansatz* that the conditional probability of $Y$ given $X$ is modeled by the softmax function\n\n$$\n\\mathbb{P}(Y=k|X=x) \\approx \\sigma_k(x W_{\\cdot k} + b_k)\n$$\n\nwhere $\\sigma = (\\sigma_0, \\ldots, \\sigma_{K-1}) \\colon \\mathbb{R}^{1\\times K} \\to \\mathbb{R}^{1 \\times K}$ is the softmax function defined as\n\n$$\n\\sigma_k(t) = \\frac{e^{t_k}}{\\sum_{h=0}^{K-1} e^{t_h}} \\quad \\text{for } t = (t_0, \\ldots, t_{K-1}) \\in \\mathbb{R}^{1\\times K} \\, , \\quad k = 0, \\ldots, K-1 \\, .\n$$\n\n$W_{\\cdot k}$ is the $k$-th column of $W \\in \\mathbb{R}^{M \\times K}$, and $b_k$ is the $k$-th element of $b \\in \\mathbb{R}^{1 \\times K}$. We want to find the parameters $W$ and $b$ that minimize the cross-entropy loss function\n\n$$\nL(W, b; \\{(x_i,y_i)\\}_{i=0,\\ldots,N-1}) = -\\sum_{i=0}^{N-1} \\sum_{k=0}^{K-1} \\tilde y_{ik} \\log \\sigma_k(x_{i\\cdot} W_{\\cdot k} + b_k) \\, ,\n$$\n\nwhere $\\tilde y_{ik} = 1$ if $y_i = k$ and $\\tilde y_{ik} = 0$ otherwise (one-hot encoding).\n\"\"\")", "code_hash": "d3fcd8e54b9a845f66abc752c7f8b169", "config": {"column": 1, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Softmax function\n\nLet us implement the softmax function.\n\"\"\")", "code_hash": "82807887528735de0da5692b7fa378b4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(r\"\"\"\n- With `torch.exp` we can compute the exponential of a tensor elementwise.\n- With `torch.sum` we can compute the sum of all the elements of a tensor, or along a specific dimension.\n\"\"\")", "code_hash": "315e3b01f8dcc2d5b9a62556f9fab4e1", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZBYS", "name": "_"}, {"code": "def _test():\n\n    t = torch.tensor([1., 4., 2.])\n    print(torch.exp(t))\n    print(torch.sum(torch.exp(t)))\n    print(torch.exp(t) / torch.sum(torch.exp(t)))\n\n_test()", "code_hash": "5240ab3b719db54195a079c8db82c64c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "mo.md(r\"\"\"\nIf we have a tensor with more rows, we want to apply the softmax function to each row.\n\"\"\")", "code_hash": "7209c0f5b5d265fb68f6c1db06134e3f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nHfw", "name": "_"}, {"code": "def _test():\n\n    t = torch.tensor([[1., 4., 2.],\n                      [3., 0., 5.]])\n    print(torch.exp(t))\n    print(torch.sum(torch.exp(t), dim=1, keepdim=True))\n    print(torch.exp(t) / torch.sum(torch.exp(t), dim=1, keepdim=True))\n\n_test()", "code_hash": "a2ec0daee76e44570ee59d358694e688", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "mo.md(r\"\"\"\nHence, we implement the softmax function as follows.\n\"\"\")", "code_hash": "eed381d1e4b8bdfd828eb4a794fc98c3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "AjVT", "name": "_"}, {"code": "def softmax(t):\n  return torch.exp(t) / torch.sum(torch.exp(t), dim=1, keepdim=True)", "code_hash": "d7dd7822075ff6967a1e35f67cf0175f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(r\"\"\"\n## The model\n\nLet us give an example of evaluation of the model.\n\"\"\")", "code_hash": "eb9b2140237cca50961bb9648edcfa39", "config": {"column": 2, "disabled": false, "hide_code": true}, "id": "NCOB", "name": "_"}, {"code": "def loss(W,b,x,y):\n\n    q = softmax(x @ W + b)\n\n    return - torch.sum(y * torch.log(q)) ", "code_hash": "09a89c53b9100d8c670cf9c9e9a137c3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aqbW", "name": "_"}, {"code": "def _ex():\n\n    W = torch.randn((n_features, n_classes))\n    b = torch.randn((1,n_classes))\n    q = softmax(x_train @ W + b)\n\n    print(q.shape)\n\n    print(f\"Loss: {loss(W,b,x_train,y_train)}\")\n\n_ex()", "code_hash": "57ade6546970d0ec9556de42586d11a2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Training\n\nFinding the minimum of the loss is not feasible explicitly. We need to use an optimization algorithm. In the next lectures we will see how to do this. For now, think of the algorithm as a black box.\n\"\"\")", "code_hash": "d8b8d4079b9d86e3fb33a836909991c7", "config": {"column": 3, "disabled": false, "hide_code": true}, "id": "TXez", "name": "_"}, {"code": "def gradient_loss(W,b,x,y):\n\n  q = softmax(x @ W + b)\n\n  # Compute gradients\n  gradL_dW = x.t() @ (q - y)\n  gradL_db = torch.sum(q - y_train, dim=0, keepdim=True)\n\n  # Norm clipping\n  norm = torch.sqrt(torch.sum(gradL_dW**2 + gradL_db**2))\n  scaling_factor = max(1, norm)\n  gradL_dW = gradL_dW / scaling_factor\n  gradL_db = gradL_db / scaling_factor\n\n  return gradL_dW, gradL_db\n\ndef update(W,b,x,y,learning_rate):\n\n  gradL_dW, gradL_db = gradient_loss(W,b,x,y)\n  W = W - learning_rate * gradL_dW\n  b = b - learning_rate * gradL_db\n\n  return W, b", "code_hash": "97a6c2e6e525c302a331542cab0eaacf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dNNg", "name": "_"}, {"code": "import time", "code_hash": "e0a5ce22ed04ce5140aa51fa409fb084", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "yCnT", "name": "_"}, {"code": "train_btn = mo.ui.run_button(label=\"Train\")\ntrain_btn", "code_hash": "1580de028f747292a19da8f59589544a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wlCL", "name": "_"}, {"code": "mo.stop(not train_btn.value, mo.md(\"Press the `Train` button to run the training.\"))\n\nlearning_rate = 0.1\nepochs = 1_000 # estimated time: 30s | accuracy: 90%\n#epochs = 5_000 # estimated time: 2m 20s | accuracy: 92%\n#epochs = 10_000 # estimated time: 4m 40s | accuracy: 92.14%\ntorch.manual_seed(42)\nW = torch.randn((n_features, n_classes))\nb = torch.tensor(0)\nlosses = []\nprint('Initial loss:', loss(W,b,x_train,y_train).item())\n\nfor epoch in mo.status.progress_bar(range(epochs), title=\"Training in progress\", completion_title=\"Training completed\", completion_subtitle=\"\", subtitle=\"Please wait...\", show_eta=True, show_rate=True):\n  if epoch % 100 == 0:\n    losses.append(loss(W,b,x_train,y_train).item())\n    print('Epoch:', epoch, 'Loss:', losses[-1])\n  W, b = update(W, b, x_train, y_train, learning_rate)\nprint('Final loss:', loss(W,b,x_train,y_train).item())", "code_hash": "f1253fbdcc0f89d11cc027200026b020", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kqZH", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet us plot how the loss behaves with the number of epochs.\n\"\"\")", "code_hash": "bd4ebd169f5ab885a272fab2834ec361", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "wAgl", "name": "_"}, {"code": "def _plot():\n\n    # plot of the loss\n    fig = plt.figure(figsize=(10, 5))\n    ax1 = fig.add_subplot(1, 2, 1)\n    ax1 = plt.plot(range(0, epochs, 100), losses)\n    ax2 = fig.add_subplot(1, 2, 2)\n    ax2 = plt.plot(range(0, epochs, 100)[2:], losses[2:])\n    plt.show()\n\n_plot()", "code_hash": "a513eac0fb170bf443354487c3664ddb", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "rEll", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Inference\n\nWe can now use the model to make predictions. We can compute the accuracy of the model on the test set.\n\nWe have produced `q`, which gives the probability of each digit for each image in the test set. For example, `q[0]` gives the probability of each digit for the first image in the test set.\n\nWe want to make a prediction by selecting the digit with the highest probability. We can use the `torch.argmax` function to extract the index of the maximum value in a tensor.\n\"\"\")", "code_hash": "650133182007b418a574cb9bba79ee64", "config": {"column": 4, "disabled": false, "hide_code": true}, "id": "dGlV", "name": "_"}, {"code": "q = softmax(x_test @ W + b)\nprint(q[0])\n\nprint(\"Predicted digit:\", torch.argmax(q[0]).item())\nprint(\"True digit:\", y_test_raw[0].item())", "code_hash": "1a79f976839fca05e48c44363ddbf513", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SdmI", "name": "_"}, {"code": "label_pred = torch.argmax(q, dim=1)\nlabel_true = torch.argmax(y_test, dim=1)\np_correct_predictions = ( torch.sum(label_pred == label_true) / n_test_samples ).item()\nprint(f'Correct predictions: {p_correct_predictions*100:.4f}%')", "code_hash": "0cdeb58830cf5f7a83101f76e61939f9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lgWD", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet us show some wrong predictions.\n\"\"\")", "code_hash": "5fcc1fd5ac727b9674677407f7d1b2a0", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "yOPj", "name": "_"}, {"code": "mask = label_pred != label_true\nwrong_images = x_test[mask]\nwrong_predictions = y_test[mask]\nwrong_labels = label_pred[mask]\ntrue_labels = label_true[mask]", "code_hash": "9d968b6a2ecb5ce9554d69b711800bab", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fwwy", "name": "_"}, {"code": "wrong_predictions_options = { f\"Predicted: {wrong_labels[i].item()} | True: {true_labels[i].item()}\": i for i in range(len(wrong_labels))}\nwrong_predictions_dropdown = mo.ui.dropdown(label=\"Choose wrong prediction\", options=wrong_predictions_options, value=list(wrong_predictions_options.keys())[0])", "code_hash": "179f9de427fce777e39e8301d209c1bf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LJZf", "name": "_"}, {"code": "wrong_predictions_dropdown", "code_hash": "f0d874c459c79808392350d782891a70", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "urSm", "name": "_"}, {"code": "def plot_wrong_prediction():\n\n    i = wrong_predictions_dropdown.value\n    title = wrong_predictions_dropdown.selected_key\n\n    fig = plt.figure(figsize=(2,2))\n    ax = fig.add_subplot(111)\n    ax.imshow(wrong_images[i,:].view(28,28), cmap='gray_r')\n    ax.set_title(title)\n    ax.axis('off')\n    ax.set_aspect('equal')\n\n    return fig\n\nplot_wrong_prediction()", "code_hash": "cbaac6edbf950247ad50f2b4192e5233", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "jxvo", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Weights\n\nWe can inspect the aspect of weights.\n\"\"\")", "code_hash": "c9aa1dbd329dae1a317c13a3f921a9f1", "config": {"column": 5, "disabled": false, "hide_code": true}, "id": "mWxS", "name": "_"}, {"code": "class_dropdown = mo.ui.dropdown(options=[i for i in range(10)], label=\"Choose class\", value=0)", "code_hash": "c796cd5b9e34a202caa8ffae992c1543", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CcZR", "name": "_"}, {"code": "def plot_weights():\n\n    fig = plt.figure(figsize=(3,3))\n    i = class_dropdown.value\n    ax = fig.add_subplot(111)\n    heatmap = ax.imshow(W[:,i].view(28,28), cmap='seismic')\n    ax.set_title(f'Class {i}')\n    ax.axis('off')\n    ax.set_aspect('equal')\n    plt.colorbar(heatmap)\n\n    return fig \n\nmo.vstack([\n    class_dropdown,\n    plot_weights()\n], justify='center', align='center')", "code_hash": "01457ea24439123e09c5606184a6aa80", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "YWSi", "name": "_"}], "metadata": {"marimo_version": "0.19.8"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "6bfe5be746aa4aaa8879e48064a1d30e", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"logistic-regression-multiclass-classification-with-mnist\"\u003ELogistic regression (multiclass classification) with MNIST\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EWe use now multiclass logistic regression to recognize the digit.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "afe07c9f4aebcd1460c8f4365f92009d", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"preparing-the-dataset\"\u003EPreparing the dataset\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe first part of this notebook is the same as the one to prepare the data in the \u003Ca href=\"03-binary_logistic_regression.py\"\u003Eprevious notebook\u003C/a\u003E. Look that for more details.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7dfed8ac5f388270761870b0fb53f597", "console": [], "id": "bkHC", "outputs": []}, {"code_hash": "13882a28341082b2248f6b668903800f", "console": [], "id": "lEQa", "outputs": []}, {"code_hash": "ee72c95ebb744f8917375d5c9d9ee7a3", "console": [], "id": "PKri", "outputs": []}, {"code_hash": "895a5079e3ea871b8b9776258137226e", "console": [], "id": "Xref", "outputs": []}, {"code_hash": "7de7c73c31fb8fc2e072b03a79f7dacf", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EBefore defining our target, we modify the target tensors in a convenient way. This will be also useful for the next notebook on multi-class classification. The original tensors contain the labels indicating the digit.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6eb23b8890991cda2bb08083c65b8635", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe labels are just words that we use to identify the digits and they only represent the class where the items in the dataset belong to. The numerical values of the labels are not relevant for the classification task. A way to represent classes numerically is to use \u003Cem\u003Eone-hot encoding\u003C/em\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EOne-hot encoding works as follows. Assume you have \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K||)\u003C/marimo-tex\u003E classes. We can enumerate the classes \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\{0,1,2,\\dots, K-1\\}||)\u003C/marimo-tex\u003E. We represent each class as a vector in a \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K||)\u003C/marimo-tex\u003E dimensional space. More precisely, each class is a coordinate direction in the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K||)\u003C/marimo-tex\u003E dimensional space. This is implemented as follows: We define the bijection\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\nk \\in \\{0,1,2,\\dots, K-1\\} \\mapsto \\begin{pmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ 1 \\\\ 0 \\\\ \\vdots \\\\ 0 \\end{pmatrix} \\in \\mathbb{R}^K,\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(1||)\u003C/marimo-tex\u003E is in the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(k||)\u003C/marimo-tex\u003E-th position (counting from \u003Cmarimo-tex class=\"arithmatex\"\u003E||(0||)\u003C/marimo-tex\u003E to \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K-1||)\u003C/marimo-tex\u003E).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b900004c686b6b207ed960d264ef4e6c", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet us implement this in Python. We use a matrix trick to do this.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Ccode\u003Etorch.eye\u003C/code\u003E function creates an identity matrix.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "33ffbe2f094fdec31f5281e9131b4c62", "console": [], "id": "Kclp", "outputs": []}, {"code_hash": "4c0387456563b191e0034c2f7f5c3e92", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe one-hot encoding of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(k||)\u003C/marimo-tex\u003E is obtained by simply extracting the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(k||)\u003C/marimo-tex\u003E-th column (or row) of the identity matrix.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "2f7cbb6c5387d66d287253299caa0d24", "console": [], "id": "Hstk", "outputs": []}, {"code_hash": "43ee735854a0d4d8a2ab691c92e3e6b4", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe reshape the tensor so that it is a column vector. The function \u003Ccode\u003Eone_hot_encode\u003C/code\u003E also works on many labels at once.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "69fbb06a6db7d625ba4f1347843076e5", "console": [], "id": "iLit", "outputs": []}, {"code_hash": "08746bc001f334a4c4eafe56aea4d041", "console": [], "id": "ZHCJ", "outputs": []}, {"code_hash": "b5fc00cf29d8a3b4108d42c43e40fb4e", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet us see some examples.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9cc9e96ca31eae9f0a387cf65c1e6f00", "console": [], "id": "qnkX", "outputs": []}, {"code_hash": "475d06eae83ae403ab134724a784b4dc", "console": [], "id": "TqIu", "outputs": []}, {"code_hash": "14f9d194e93ecf08fcd1333b23d19409", "console": [], "id": "Vxnm", "outputs": []}, {"code_hash": "e10e1ad1714ad9b47df59ffcff931385", "console": [], "id": "DnEU", "outputs": []}, {"code_hash": null, "console": [], "id": "ulZA", "outputs": []}, {"code_hash": "d3fcd8e54b9a845f66abc752c7f8b169", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"multiclass-logistic-regression\"\u003EMulticlass logistic regression\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWe recall how multiclass logistic regression works. We have some data \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\{(x_i, y_i)\\}_{i=0, \\ldots, N-1}||)\u003C/marimo-tex\u003E where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(x_i \\in \\mathbb{R}^{1\\times M}||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(y_i \\in \\{0, 1, \\ldots, K-1\\}||)\u003C/marimo-tex\u003E. The data are thought as realizations of a random sample \u003Cmarimo-tex class=\"arithmatex\"\u003E||((X_0, Y_0), \\ldots, (X_{N-1}, Y_{N-1})||)\u003C/marimo-tex\u003E drawn from a certain distribution. We make the \u003Cem\u003Eansatz\u003C/em\u003E that the conditional probability of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(Y||)\u003C/marimo-tex\u003E given \u003Cmarimo-tex class=\"arithmatex\"\u003E||(X||)\u003C/marimo-tex\u003E is modeled by the softmax function\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbb{P}(Y=k|X=x) \\approx \\sigma_k(x W_{\\cdot k} + b_k)\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\sigma = (\\sigma_0, \\ldots, \\sigma_{K-1}) \\colon \\mathbb{R}^{1\\times K} \\to \\mathbb{R}^{1 \\times K}||)\u003C/marimo-tex\u003E is the softmax function defined as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\sigma_k(t) = \\frac{e^{t_k}}{\\sum_{h=0}^{K-1} e^{t_h}} \\quad \\text{for } t = (t_0, \\ldots, t_{K-1}) \\in \\mathbb{R}^{1\\times K} \\, , \\quad k = 0, \\ldots, K-1 \\, .\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||(W_{\\cdot k}||)\u003C/marimo-tex\u003E is the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(k||)\u003C/marimo-tex\u003E-th column of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W \\in \\mathbb{R}^{M \\times K}||)\u003C/marimo-tex\u003E, and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(b_k||)\u003C/marimo-tex\u003E is the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(k||)\u003C/marimo-tex\u003E-th element of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(b \\in \\mathbb{R}^{1 \\times K}||)\u003C/marimo-tex\u003E. We want to find the parameters \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(b||)\u003C/marimo-tex\u003E that minimize the cross-entropy loss function\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\nL(W, b; \\{(x_i,y_i)\\}_{i=0,\\ldots,N-1}) = -\\sum_{i=0}^{N-1} \\sum_{k=0}^{K-1} \\tilde y_{ik} \\log \\sigma_k(x_{i\\cdot} W_{\\cdot k} + b_k) \\, ,\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\tilde y_{ik} = 1||)\u003C/marimo-tex\u003E if \u003Cmarimo-tex class=\"arithmatex\"\u003E||(y_i = k||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\tilde y_{ik} = 0||)\u003C/marimo-tex\u003E otherwise (one-hot encoding).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "82807887528735de0da5692b7fa378b4", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"softmax-function\"\u003ESoftmax function\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ELet us implement the softmax function.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "315e3b01f8dcc2d5b9a62556f9fab4e1", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cul\u003E\n\u003Cli\u003EWith \u003Ccode\u003Etorch.exp\u003C/code\u003E we can compute the exponential of a tensor elementwise.\u003C/li\u003E\n\u003Cli\u003EWith \u003Ccode\u003Etorch.sum\u003C/code\u003E we can compute the sum of all the elements of a tensor, or along a specific dimension.\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5240ab3b719db54195a079c8db82c64c", "console": [], "id": "aLJB", "outputs": []}, {"code_hash": "7209c0f5b5d265fb68f6c1db06134e3f", "console": [], "id": "nHfw", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIf we have a tensor with more rows, we want to apply the softmax function to each row.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a2ec0daee76e44570ee59d358694e688", "console": [], "id": "xXTn", "outputs": []}, {"code_hash": "eed381d1e4b8bdfd828eb4a794fc98c3", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EHence, we implement the softmax function as follows.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d7dd7822075ff6967a1e35f67cf0175f", "console": [], "id": "pHFh", "outputs": []}, {"code_hash": "eb9b2140237cca50961bb9648edcfa39", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-model\"\u003EThe model\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ELet us give an example of evaluation of the model.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "09a89c53b9100d8c670cf9c9e9a137c3", "console": [], "id": "aqbW", "outputs": []}, {"code_hash": "57ade6546970d0ec9556de42586d11a2", "console": [], "id": "TRpd", "outputs": []}, {"code_hash": "d8b8d4079b9d86e3fb33a836909991c7", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"training\"\u003ETraining\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EFinding the minimum of the loss is not feasible explicitly. We need to use an optimization algorithm. In the next lectures we will see how to do this. For now, think of the algorithm as a black box.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "97a6c2e6e525c302a331542cab0eaacf", "console": [], "id": "dNNg", "outputs": []}, {"code_hash": "e0a5ce22ed04ce5140aa51fa409fb084", "console": [], "id": "yCnT", "outputs": []}, {"code_hash": "1580de028f747292a19da8f59589544a", "console": [], "id": "wlCL", "outputs": []}, {"code_hash": "f1253fbdcc0f89d11cc027200026b020", "console": [], "id": "kqZH", "outputs": []}, {"code_hash": "bd4ebd169f5ab885a272fab2834ec361", "console": [], "id": "wAgl", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet us plot how the loss behaves with the number of epochs.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a513eac0fb170bf443354487c3664ddb", "console": [], "id": "rEll", "outputs": []}, {"code_hash": "650133182007b418a574cb9bba79ee64", "console": [], "id": "dGlV", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"inference\"\u003EInference\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can now use the model to make predictions. We can compute the accuracy of the model on the test set.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe have produced \u003Ccode\u003Eq\u003C/code\u003E, which gives the probability of each digit for each image in the test set. For example, \u003Ccode\u003Eq[0]\u003C/code\u003E gives the probability of each digit for the first image in the test set.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe want to make a prediction by selecting the digit with the highest probability. We can use the \u003Ccode\u003Etorch.argmax\u003C/code\u003E function to extract the index of the maximum value in a tensor.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1a79f976839fca05e48c44363ddbf513", "console": [], "id": "SdmI", "outputs": []}, {"code_hash": "0cdeb58830cf5f7a83101f76e61939f9", "console": [], "id": "lgWD", "outputs": []}, {"code_hash": "5fcc1fd5ac727b9674677407f7d1b2a0", "console": [], "id": "yOPj", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet us show some wrong predictions.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9d968b6a2ecb5ce9554d69b711800bab", "console": [], "id": "fwwy", "outputs": []}, {"code_hash": "179f9de427fce777e39e8301d209c1bf", "console": [], "id": "LJZf", "outputs": []}, {"code_hash": "f0d874c459c79808392350d782891a70", "console": [], "id": "urSm", "outputs": []}, {"code_hash": "cbaac6edbf950247ad50f2b4192e5233", "console": [], "id": "jxvo", "outputs": []}, {"code_hash": "c9aa1dbd329dae1a317c13a3f921a9f1", "console": [], "id": "mWxS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"weights\"\u003EWeights\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can inspect the aspect of weights.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c796cd5b9e34a202caa8ffae992c1543", "console": [], "id": "CcZR", "outputs": []}, {"code_hash": "01457ea24439123e09c5606184a6aa80", "console": [], "id": "YWSi", "outputs": []}], "metadata": {"marimo_version": "0.19.8"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    %23%20%2F%2F%2F%20script%0A%23%20requires-python%20%3D%20%22%3E%3D3.14%22%0A%23%20dependencies%20%3D%20%5B%0A%23%20%20%20%20%22marimo%3E%3D0.19.7%22%2C%0A%23%20%20%20%20%22matplotlib%3D%3D3.10.8%22%2C%0A%23%20%20%20%20%22pandas%3D%3D3.0.0%22%2C%0A%23%20%20%20%20%22torch%3D%3D2.9.1%22%2C%0A%23%20%5D%0A%23%20%2F%2F%2F%0A%0Aimport%20marimo%0A%0A__generated_with%20%3D%20%220.19.8%22%0Aapp%20%3D%20marimo.App(%0A%20%20%20%20width%3D%22columns%22%2C%0A%20%20%20%20app_title%3D%22Multiclass%20Logistic%20Regression%22%2C%0A%20%20%20%20css_file%3D%22style.css%22%2C%0A%20%20%20%20auto_download%3D%5B%22html%22%5D%2C%0A)%0A%0A%0A%40app.cell(column%3D0%2C%20hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Logistic%20regression%20(multiclass%20classification)%20with%20MNIST%0A%0A%20%20%20%20We%20use%20now%20multiclass%20logistic%20regression%20to%20recognize%20the%20digit.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Preparing%20the%20dataset%0A%0A%20%20%20%20The%20first%20part%20of%20this%20notebook%20is%20the%20same%20as%20the%20one%20to%20prepare%20the%20data%20in%20the%20%5Bprevious%20notebook%5D(03-binary_logistic_regression.py).%20Look%20that%20for%20more%20details.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20torch%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%0A%20%20%20%20return%20pd%2C%20plt%2C%20torch%0A%0A%0A%40app.cell%0Adef%20_(pd)%3A%0A%20%20%20%20from%20pathlib%20import%20Path%0A%0A%20%20%20%20BASE_DIR%20%3D%20Path(__file__).resolve().parent.parent%0A%0A%20%20%20%20data_path%20%3D%20BASE_DIR%20%2F%20'datasets'%20%2F%20'mnist_train.csv'%0A%20%20%20%20mnist_train%20%3D%20pd.read_csv(data_path)%0A%20%20%20%20data_path%20%3D%20BASE_DIR%20%2F%20'datasets'%20%2F%20'mnist_test.csv'%0A%20%20%20%20mnist_test%20%3D%20pd.read_csv(data_path)%0A%20%20%20%20return%20mnist_test%2C%20mnist_train%0A%0A%0A%40app.cell%0Adef%20_(mnist_train)%3A%0A%20%20%20%20mnist_train%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mnist_test)%3A%0A%20%20%20%20mnist_test%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Before%20defining%20our%20target%2C%20we%20modify%20the%20target%20tensors%20in%20a%20convenient%20way.%20This%20will%20be%20also%20useful%20for%20the%20next%20notebook%20on%20multi-class%20classification.%20The%20original%20tensors%20contain%20the%20labels%20indicating%20the%20digit.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20labels%20are%20just%20words%20that%20we%20use%20to%20identify%20the%20digits%20and%20they%20only%20represent%20the%20class%20where%20the%20items%20in%20the%20dataset%20belong%20to.%20The%20numerical%20values%20of%20the%20labels%20are%20not%20relevant%20for%20the%20classification%20task.%20A%20way%20to%20represent%20classes%20numerically%20is%20to%20use%20*one-hot%20encoding*.%0A%0A%20%20%20%20One-hot%20encoding%20works%20as%20follows.%20Assume%20you%20have%20%24K%24%20classes.%20We%20can%20enumerate%20the%20classes%20%24%5C%7B0%2C1%2C2%2C%5Cdots%2C%20K-1%5C%7D%24.%20We%20represent%20each%20class%20as%20a%20vector%20in%20a%20%24K%24%20dimensional%20space.%20More%20precisely%2C%20each%20class%20is%20a%20coordinate%20direction%20in%20the%20%24K%24%20dimensional%20space.%20This%20is%20implemented%20as%20follows%3A%20We%20define%20the%20bijection%0A%0A%20%20%20%20%24%24%0A%20%20%20%20k%20%5Cin%20%5C%7B0%2C1%2C2%2C%5Cdots%2C%20K-1%5C%7D%20%5Cmapsto%20%5Cbegin%7Bpmatrix%7D%200%20%5C%5C%20%5Cvdots%20%5C%5C%200%20%5C%5C%201%20%5C%5C%200%20%5C%5C%20%5Cvdots%20%5C%5C%200%20%5Cend%7Bpmatrix%7D%20%5Cin%20%5Cmathbb%7BR%7D%5EK%2C%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20the%20%241%24%20is%20in%20the%20%24k%24-th%20position%20(counting%20from%20%240%24%20to%20%24K-1%24).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let%20us%20implement%20this%20in%20Python.%20We%20use%20a%20matrix%20trick%20to%20do%20this.%0A%0A%20%20%20%20The%20%60torch.eye%60%20function%20creates%20an%20identity%20matrix.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20torch.eye(10)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20one-hot%20encoding%20of%20%24k%24%20is%20obtained%20by%20simply%20extracting%20the%20%24k%24-th%20column%20(or%20row)%20of%20the%20identity%20matrix.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20torch.eye(10)%5B2%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20reshape%20the%20tensor%20so%20that%20it%20is%20a%20column%20vector.%20The%20function%20%60one_hot_encode%60%20also%20works%20on%20many%20labels%20at%20once.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20def%20one_hot_encode(y%2C%20num_classes)%3A%0A%20%20%20%20%20%20%20%20n_samples%20%3D%20y.shape%5B0%5D%0A%20%20%20%20%20%20%20%20return%20torch.eye(num_classes)%5By%5D.view(n_samples%2C%20num_classes)%0A%0A%20%20%20%20return%20(one_hot_encode%2C)%0A%0A%0A%40app.cell%0Adef%20_(one_hot_encode%2C%20y_test_raw%2C%20y_train_raw)%3A%0A%20%20%20%20y_train_one_hot%20%3D%20one_hot_encode(y_train_raw%2C%2010)%0A%20%20%20%20y_test_one_hot%20%3D%20one_hot_encode(y_test_raw%2C%2010)%0A%20%20%20%20return%20(y_train_one_hot%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let%20us%20see%20some%20examples.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(y_train_one_hot%2C%20y_train_raw)%3A%0A%20%20%20%20for%20_i%20in%20range(7)%3A%0A%20%20%20%20%20%20print(f%22Label%3A%20%7By_train_raw%5B_i%2C%3A%5D.item()%7D%20%7C%20One-hot%20encoding%3A%20%7By_train_one_hot%5B_i%2C%3A%5D%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mnist_test%2C%20mnist_train%2C%20one_hot_encode%2C%20torch)%3A%0A%20%20%20%20x_train_raw%20%3D%20torch.tensor(mnist_train.iloc%5B%3A%2C%201%3A%5D.values%2C%20dtype%3Dtorch.float32)%0A%20%20%20%20x_test_raw%20%3D%20torch.tensor(mnist_test.iloc%5B%3A%2C%201%3A%5D.values%2C%20dtype%3Dtorch.float32)%0A%0A%20%20%20%20x_train%20%3D%20x_train_raw%20%2F%20255%20%0A%20%20%20%20x_test%20%3D%20x_test_raw%20%2F%20255%0A%0A%20%20%20%20y_train_raw%20%3D%20torch.tensor(mnist_train.iloc%5B%3A%2C0%5D.values%2C%20dtype%3Dtorch.int64).view(-1%2C1)%0A%20%20%20%20y_test_raw%20%3D%20torch.tensor(mnist_test.iloc%5B%3A%2C0%5D.values%2C%20dtype%3Dtorch.int64).view(-1%2C1)%0A%0A%20%20%20%20y_train%20%3D%20one_hot_encode(y_train_raw%2C%2010)%0A%20%20%20%20y_test%20%3D%20one_hot_encode(y_test_raw%2C%2010)%0A%20%20%20%20return%20x_test%2C%20x_train%2C%20y_test%2C%20y_test_raw%2C%20y_train%2C%20y_train_raw%0A%0A%0A%40app.cell%0Adef%20_(x_test%2C%20x_train%2C%20y_train)%3A%0A%20%20%20%20n_training_samples%20%3D%20x_train.shape%5B0%5D%0A%20%20%20%20n_test_samples%20%3D%20x_test.shape%5B0%5D%0A%20%20%20%20n_features%20%3D%20x_train.shape%5B1%5D%0A%20%20%20%20n_classes%20%3D%20y_train.shape%5B1%5D%0A%20%20%20%20n_classes%2C%20n_features%2C%20n_training_samples%2C%20n_test_samples%0A%20%20%20%20return%20n_classes%2C%20n_features%2C%20n_test_samples%0A%0A%0A%40app.cell%0Adef%20_(plt%2C%20x_train%2C%20y_train)%3A%0A%20%20%20%20def%20_plot()%3A%0A%0A%20%20%20%20%20%20%20%20%23%20sample%20plot%20of%20the%20data%0A%20%20%20%20%20%20%20%20n_sample%20%3D%2010%0A%20%20%20%20%20%20%20%20fig%20%3D%20plt.figure(figsize%3D(n_sample%2C%203))%0A%20%20%20%20%20%20%20%20axs%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(n_sample)%3A%0A%20%20%20%20%20%20%20%20%20%20axs.append(fig.add_subplot(1%2C%20n_sample%2C%20i%2B1))%0A%20%20%20%20%20%20%20%20%20%20axs%5Bi%5D.imshow(x_train%5Bi%2C%3A%5D.view(28%2C28)%2C%20cmap%3D'gray_r')%0A%20%20%20%20%20%20%20%20%20%20axs%5Bi%5D.set_title(f'%7B(y_train%5Bi%2C%3A%5D%3D%3D1).nonzero().item()%3A.0f%7D%20')%0A%20%20%20%20%20%20%20%20%20%20axs%5Bi%5D.axis('off')%0A%20%20%20%20%20%20%20%20plt.show()%0A%0A%20%20%20%20_plot()%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0A%40app.cell(column%3D1%2C%20hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Multiclass%20logistic%20regression%0A%0A%20%20%20%20We%20recall%20how%20multiclass%20logistic%20regression%20works.%20We%20have%20some%20data%20%24%5C%7B(x_i%2C%20y_i)%5C%7D_%7Bi%3D0%2C%20%5Cldots%2C%20N-1%7D%24%20where%20%24x_i%20%5Cin%20%5Cmathbb%7BR%7D%5E%7B1%5Ctimes%20M%7D%24%20and%20%24y_i%20%5Cin%20%5C%7B0%2C%201%2C%20%5Cldots%2C%20K-1%5C%7D%24.%20The%20data%20are%20thought%20as%20realizations%20of%20a%20random%20sample%20%24(X_0%2C%20Y_0)%2C%20%5Cldots%2C%20(X_%7BN-1%7D%2C%20Y_%7BN-1%7D)%24%20drawn%20from%20a%20certain%20distribution.%20We%20make%20the%20*ansatz*%20that%20the%20conditional%20probability%20of%20%24Y%24%20given%20%24X%24%20is%20modeled%20by%20the%20softmax%20function%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbb%7BP%7D(Y%3Dk%7CX%3Dx)%20%5Capprox%20%5Csigma_k(x%20W_%7B%5Ccdot%20k%7D%20%2B%20b_k)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5Csigma%20%3D%20(%5Csigma_0%2C%20%5Cldots%2C%20%5Csigma_%7BK-1%7D)%20%5Ccolon%20%5Cmathbb%7BR%7D%5E%7B1%5Ctimes%20K%7D%20%5Cto%20%5Cmathbb%7BR%7D%5E%7B1%20%5Ctimes%20K%7D%24%20is%20the%20softmax%20function%20defined%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Csigma_k(t)%20%3D%20%5Cfrac%7Be%5E%7Bt_k%7D%7D%7B%5Csum_%7Bh%3D0%7D%5E%7BK-1%7D%20e%5E%7Bt_h%7D%7D%20%5Cquad%20%5Ctext%7Bfor%20%7D%20t%20%3D%20(t_0%2C%20%5Cldots%2C%20t_%7BK-1%7D)%20%5Cin%20%5Cmathbb%7BR%7D%5E%7B1%5Ctimes%20K%7D%20%5C%2C%20%2C%20%5Cquad%20k%20%3D%200%2C%20%5Cldots%2C%20K-1%20%5C%2C%20.%0A%20%20%20%20%24%24%0A%0A%20%20%20%20%24W_%7B%5Ccdot%20k%7D%24%20is%20the%20%24k%24-th%20column%20of%20%24W%20%5Cin%20%5Cmathbb%7BR%7D%5E%7BM%20%5Ctimes%20K%7D%24%2C%20and%20%24b_k%24%20is%20the%20%24k%24-th%20element%20of%20%24b%20%5Cin%20%5Cmathbb%7BR%7D%5E%7B1%20%5Ctimes%20K%7D%24.%20We%20want%20to%20find%20the%20parameters%20%24W%24%20and%20%24b%24%20that%20minimize%20the%20cross-entropy%20loss%20function%0A%0A%20%20%20%20%24%24%0A%20%20%20%20L(W%2C%20b%3B%20%5C%7B(x_i%2Cy_i)%5C%7D_%7Bi%3D0%2C%5Cldots%2CN-1%7D)%20%3D%20-%5Csum_%7Bi%3D0%7D%5E%7BN-1%7D%20%5Csum_%7Bk%3D0%7D%5E%7BK-1%7D%20%5Ctilde%20y_%7Bik%7D%20%5Clog%20%5Csigma_k(x_%7Bi%5Ccdot%7D%20W_%7B%5Ccdot%20k%7D%20%2B%20b_k)%20%5C%2C%20%2C%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5Ctilde%20y_%7Bik%7D%20%3D%201%24%20if%20%24y_i%20%3D%20k%24%20and%20%24%5Ctilde%20y_%7Bik%7D%20%3D%200%24%20otherwise%20(one-hot%20encoding).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Softmax%20function%0A%0A%20%20%20%20Let%20us%20implement%20the%20softmax%20function.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20-%20With%20%60torch.exp%60%20we%20can%20compute%20the%20exponential%20of%20a%20tensor%20elementwise.%0A%20%20%20%20-%20With%20%60torch.sum%60%20we%20can%20compute%20the%20sum%20of%20all%20the%20elements%20of%20a%20tensor%2C%20or%20along%20a%20specific%20dimension.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20def%20_test()%3A%0A%0A%20%20%20%20%20%20%20%20t%20%3D%20torch.tensor(%5B1.%2C%204.%2C%202.%5D)%0A%20%20%20%20%20%20%20%20print(torch.exp(t))%0A%20%20%20%20%20%20%20%20print(torch.sum(torch.exp(t)))%0A%20%20%20%20%20%20%20%20print(torch.exp(t)%20%2F%20torch.sum(torch.exp(t)))%0A%0A%20%20%20%20_test()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20If%20we%20have%20a%20tensor%20with%20more%20rows%2C%20we%20want%20to%20apply%20the%20softmax%20function%20to%20each%20row.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20def%20_test()%3A%0A%0A%20%20%20%20%20%20%20%20t%20%3D%20torch.tensor(%5B%5B1.%2C%204.%2C%202.%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B3.%2C%200.%2C%205.%5D%5D)%0A%20%20%20%20%20%20%20%20print(torch.exp(t))%0A%20%20%20%20%20%20%20%20print(torch.sum(torch.exp(t)%2C%20dim%3D1%2C%20keepdim%3DTrue))%0A%20%20%20%20%20%20%20%20print(torch.exp(t)%20%2F%20torch.sum(torch.exp(t)%2C%20dim%3D1%2C%20keepdim%3DTrue))%0A%0A%20%20%20%20_test()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Hence%2C%20we%20implement%20the%20softmax%20function%20as%20follows.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch)%3A%0A%20%20%20%20def%20softmax(t)%3A%0A%20%20%20%20%20%20return%20torch.exp(t)%20%2F%20torch.sum(torch.exp(t)%2C%20dim%3D1%2C%20keepdim%3DTrue)%0A%0A%20%20%20%20return%20(softmax%2C)%0A%0A%0A%40app.cell(column%3D2%2C%20hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20model%0A%0A%20%20%20%20Let%20us%20give%20an%20example%20of%20evaluation%20of%20the%20model.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(softmax%2C%20torch)%3A%0A%20%20%20%20def%20loss(W%2Cb%2Cx%2Cy)%3A%0A%0A%20%20%20%20%20%20%20%20q%20%3D%20softmax(x%20%40%20W%20%2B%20b)%0A%0A%20%20%20%20%20%20%20%20return%20-%20torch.sum(y%20*%20torch.log(q))%20%0A%0A%20%20%20%20return%20(loss%2C)%0A%0A%0A%40app.cell%0Adef%20_(loss%2C%20n_classes%2C%20n_features%2C%20softmax%2C%20torch%2C%20x_train%2C%20y_train)%3A%0A%20%20%20%20def%20_ex()%3A%0A%0A%20%20%20%20%20%20%20%20W%20%3D%20torch.randn((n_features%2C%20n_classes))%0A%20%20%20%20%20%20%20%20b%20%3D%20torch.randn((1%2Cn_classes))%0A%20%20%20%20%20%20%20%20q%20%3D%20softmax(x_train%20%40%20W%20%2B%20b)%0A%0A%20%20%20%20%20%20%20%20print(q.shape)%0A%0A%20%20%20%20%20%20%20%20print(f%22Loss%3A%20%7Bloss(W%2Cb%2Cx_train%2Cy_train)%7D%22)%0A%0A%20%20%20%20_ex()%0A%20%20%20%20return%0A%0A%0A%40app.cell(column%3D3%2C%20hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Training%0A%0A%20%20%20%20Finding%20the%20minimum%20of%20the%20loss%20is%20not%20feasible%20explicitly.%20We%20need%20to%20use%20an%20optimization%20algorithm.%20In%20the%20next%20lectures%20we%20will%20see%20how%20to%20do%20this.%20For%20now%2C%20think%20of%20the%20algorithm%20as%20a%20black%20box.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(softmax%2C%20torch%2C%20y_train)%3A%0A%20%20%20%20def%20gradient_loss(W%2Cb%2Cx%2Cy)%3A%0A%0A%20%20%20%20%20%20q%20%3D%20softmax(x%20%40%20W%20%2B%20b)%0A%0A%20%20%20%20%20%20%23%20Compute%20gradients%0A%20%20%20%20%20%20gradL_dW%20%3D%20x.t()%20%40%20(q%20-%20y)%0A%20%20%20%20%20%20gradL_db%20%3D%20torch.sum(q%20-%20y_train%2C%20dim%3D0%2C%20keepdim%3DTrue)%0A%0A%20%20%20%20%20%20%23%20Norm%20clipping%0A%20%20%20%20%20%20norm%20%3D%20torch.sqrt(torch.sum(gradL_dW**2%20%2B%20gradL_db**2))%0A%20%20%20%20%20%20scaling_factor%20%3D%20max(1%2C%20norm)%0A%20%20%20%20%20%20gradL_dW%20%3D%20gradL_dW%20%2F%20scaling_factor%0A%20%20%20%20%20%20gradL_db%20%3D%20gradL_db%20%2F%20scaling_factor%0A%0A%20%20%20%20%20%20return%20gradL_dW%2C%20gradL_db%0A%0A%20%20%20%20def%20update(W%2Cb%2Cx%2Cy%2Clearning_rate)%3A%0A%0A%20%20%20%20%20%20gradL_dW%2C%20gradL_db%20%3D%20gradient_loss(W%2Cb%2Cx%2Cy)%0A%20%20%20%20%20%20W%20%3D%20W%20-%20learning_rate%20*%20gradL_dW%0A%20%20%20%20%20%20b%20%3D%20b%20-%20learning_rate%20*%20gradL_db%0A%0A%20%20%20%20%20%20return%20W%2C%20b%0A%0A%20%20%20%20return%20(update%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20time%0A%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20train_btn%20%3D%20mo.ui.run_button(label%3D%22Train%22)%0A%20%20%20%20train_btn%0A%20%20%20%20return%20(train_btn%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20loss%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20n_classes%2C%0A%20%20%20%20n_features%2C%0A%20%20%20%20torch%2C%0A%20%20%20%20train_btn%2C%0A%20%20%20%20update%2C%0A%20%20%20%20x_train%2C%0A%20%20%20%20y_train%2C%0A)%3A%0A%20%20%20%20mo.stop(not%20train_btn.value%2C%20mo.md(%22Press%20the%20%60Train%60%20button%20to%20run%20the%20training.%22))%0A%0A%20%20%20%20learning_rate%20%3D%200.1%0A%20%20%20%20epochs%20%3D%201_000%20%23%20estimated%20time%3A%2030s%20%7C%20accuracy%3A%2090%25%0A%20%20%20%20%23epochs%20%3D%205_000%20%23%20estimated%20time%3A%202m%2020s%20%7C%20accuracy%3A%2092%25%0A%20%20%20%20%23epochs%20%3D%2010_000%20%23%20estimated%20time%3A%204m%2040s%20%7C%20accuracy%3A%2092.14%25%0A%20%20%20%20torch.manual_seed(42)%0A%20%20%20%20W%20%3D%20torch.randn((n_features%2C%20n_classes))%0A%20%20%20%20b%20%3D%20torch.tensor(0)%0A%20%20%20%20losses%20%3D%20%5B%5D%0A%20%20%20%20print('Initial%20loss%3A'%2C%20loss(W%2Cb%2Cx_train%2Cy_train).item())%0A%0A%20%20%20%20for%20epoch%20in%20mo.status.progress_bar(range(epochs)%2C%20title%3D%22Training%20in%20progress%22%2C%20completion_title%3D%22Training%20completed%22%2C%20completion_subtitle%3D%22%22%2C%20subtitle%3D%22Please%20wait...%22%2C%20show_eta%3DTrue%2C%20show_rate%3DTrue)%3A%0A%20%20%20%20%20%20if%20epoch%20%25%20100%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20losses.append(loss(W%2Cb%2Cx_train%2Cy_train).item())%0A%20%20%20%20%20%20%20%20print('Epoch%3A'%2C%20epoch%2C%20'Loss%3A'%2C%20losses%5B-1%5D)%0A%20%20%20%20%20%20W%2C%20b%20%3D%20update(W%2C%20b%2C%20x_train%2C%20y_train%2C%20learning_rate)%0A%20%20%20%20print('Final%20loss%3A'%2C%20loss(W%2Cb%2Cx_train%2Cy_train).item())%0A%20%20%20%20return%20W%2C%20b%2C%20epochs%2C%20losses%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let%20us%20plot%20how%20the%20loss%20behaves%20with%20the%20number%20of%20epochs.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(epochs%2C%20losses%2C%20plt)%3A%0A%20%20%20%20def%20_plot()%3A%0A%0A%20%20%20%20%20%20%20%20%23%20plot%20of%20the%20loss%0A%20%20%20%20%20%20%20%20fig%20%3D%20plt.figure(figsize%3D(10%2C%205))%0A%20%20%20%20%20%20%20%20ax1%20%3D%20fig.add_subplot(1%2C%202%2C%201)%0A%20%20%20%20%20%20%20%20ax1%20%3D%20plt.plot(range(0%2C%20epochs%2C%20100)%2C%20losses)%0A%20%20%20%20%20%20%20%20ax2%20%3D%20fig.add_subplot(1%2C%202%2C%202)%0A%20%20%20%20%20%20%20%20ax2%20%3D%20plt.plot(range(0%2C%20epochs%2C%20100)%5B2%3A%5D%2C%20losses%5B2%3A%5D)%0A%20%20%20%20%20%20%20%20plt.show()%0A%0A%20%20%20%20_plot()%0A%20%20%20%20return%0A%0A%0A%40app.cell(column%3D4%2C%20hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Inference%0A%0A%20%20%20%20We%20can%20now%20use%20the%20model%20to%20make%20predictions.%20We%20can%20compute%20the%20accuracy%20of%20the%20model%20on%20the%20test%20set.%0A%0A%20%20%20%20We%20have%20produced%20%60q%60%2C%20which%20gives%20the%20probability%20of%20each%20digit%20for%20each%20image%20in%20the%20test%20set.%20For%20example%2C%20%60q%5B0%5D%60%20gives%20the%20probability%20of%20each%20digit%20for%20the%20first%20image%20in%20the%20test%20set.%0A%0A%20%20%20%20We%20want%20to%20make%20a%20prediction%20by%20selecting%20the%20digit%20with%20the%20highest%20probability.%20We%20can%20use%20the%20%60torch.argmax%60%20function%20to%20extract%20the%20index%20of%20the%20maximum%20value%20in%20a%20tensor.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(W%2C%20b%2C%20softmax%2C%20torch%2C%20x_test%2C%20y_test_raw)%3A%0A%20%20%20%20q%20%3D%20softmax(x_test%20%40%20W%20%2B%20b)%0A%20%20%20%20print(q%5B0%5D)%0A%0A%20%20%20%20print(%22Predicted%20digit%3A%22%2C%20torch.argmax(q%5B0%5D).item())%0A%20%20%20%20print(%22True%20digit%3A%22%2C%20y_test_raw%5B0%5D.item())%0A%20%20%20%20return%20(q%2C)%0A%0A%0A%40app.cell%0Adef%20_(n_test_samples%2C%20q%2C%20torch%2C%20y_test)%3A%0A%20%20%20%20label_pred%20%3D%20torch.argmax(q%2C%20dim%3D1)%0A%20%20%20%20label_true%20%3D%20torch.argmax(y_test%2C%20dim%3D1)%0A%20%20%20%20p_correct_predictions%20%3D%20(%20torch.sum(label_pred%20%3D%3D%20label_true)%20%2F%20n_test_samples%20).item()%0A%20%20%20%20print(f'Correct%20predictions%3A%20%7Bp_correct_predictions*100%3A.4f%7D%25')%0A%20%20%20%20return%20label_pred%2C%20label_true%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let%20us%20show%20some%20wrong%20predictions.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(label_pred%2C%20label_true%2C%20x_test%2C%20y_test)%3A%0A%20%20%20%20mask%20%3D%20label_pred%20!%3D%20label_true%0A%20%20%20%20wrong_images%20%3D%20x_test%5Bmask%5D%0A%20%20%20%20wrong_predictions%20%3D%20y_test%5Bmask%5D%0A%20%20%20%20wrong_labels%20%3D%20label_pred%5Bmask%5D%0A%20%20%20%20true_labels%20%3D%20label_true%5Bmask%5D%0A%20%20%20%20return%20true_labels%2C%20wrong_images%2C%20wrong_labels%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20true_labels%2C%20wrong_labels)%3A%0A%20%20%20%20wrong_predictions_options%20%3D%20%7B%20f%22Predicted%3A%20%7Bwrong_labels%5Bi%5D.item()%7D%20%7C%20True%3A%20%7Btrue_labels%5Bi%5D.item()%7D%22%3A%20i%20for%20i%20in%20range(len(wrong_labels))%7D%0A%20%20%20%20wrong_predictions_dropdown%20%3D%20mo.ui.dropdown(label%3D%22Choose%20wrong%20prediction%22%2C%20options%3Dwrong_predictions_options%2C%20value%3Dlist(wrong_predictions_options.keys())%5B0%5D)%0A%20%20%20%20return%20(wrong_predictions_dropdown%2C)%0A%0A%0A%40app.cell%0Adef%20_(wrong_predictions_dropdown)%3A%0A%20%20%20%20wrong_predictions_dropdown%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(plt%2C%20wrong_images%2C%20wrong_predictions_dropdown)%3A%0A%20%20%20%20def%20plot_wrong_prediction()%3A%0A%0A%20%20%20%20%20%20%20%20i%20%3D%20wrong_predictions_dropdown.value%0A%20%20%20%20%20%20%20%20title%20%3D%20wrong_predictions_dropdown.selected_key%0A%0A%20%20%20%20%20%20%20%20fig%20%3D%20plt.figure(figsize%3D(2%2C2))%0A%20%20%20%20%20%20%20%20ax%20%3D%20fig.add_subplot(111)%0A%20%20%20%20%20%20%20%20ax.imshow(wrong_images%5Bi%2C%3A%5D.view(28%2C28)%2C%20cmap%3D'gray_r')%0A%20%20%20%20%20%20%20%20ax.set_title(title)%0A%20%20%20%20%20%20%20%20ax.axis('off')%0A%20%20%20%20%20%20%20%20ax.set_aspect('equal')%0A%0A%20%20%20%20%20%20%20%20return%20fig%0A%0A%20%20%20%20plot_wrong_prediction()%0A%20%20%20%20return%0A%0A%0A%40app.cell(column%3D5%2C%20hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Weights%0A%0A%20%20%20%20We%20can%20inspect%20the%20aspect%20of%20weights.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20class_dropdown%20%3D%20mo.ui.dropdown(options%3D%5Bi%20for%20i%20in%20range(10)%5D%2C%20label%3D%22Choose%20class%22%2C%20value%3D0)%0A%20%20%20%20return%20(class_dropdown%2C)%0A%0A%0A%40app.cell%0Adef%20_(W%2C%20class_dropdown%2C%20mo%2C%20plt)%3A%0A%20%20%20%20def%20plot_weights()%3A%0A%0A%20%20%20%20%20%20%20%20fig%20%3D%20plt.figure(figsize%3D(3%2C3))%0A%20%20%20%20%20%20%20%20i%20%3D%20class_dropdown.value%0A%20%20%20%20%20%20%20%20ax%20%3D%20fig.add_subplot(111)%0A%20%20%20%20%20%20%20%20heatmap%20%3D%20ax.imshow(W%5B%3A%2Ci%5D.view(28%2C28)%2C%20cmap%3D'seismic')%0A%20%20%20%20%20%20%20%20ax.set_title(f'Class%20%7Bi%7D')%0A%20%20%20%20%20%20%20%20ax.axis('off')%0A%20%20%20%20%20%20%20%20ax.set_aspect('equal')%0A%20%20%20%20%20%20%20%20plt.colorbar(heatmap)%0A%0A%20%20%20%20%20%20%20%20return%20fig%20%0A%0A%20%20%20%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20class_dropdown%2C%0A%20%20%20%20%20%20%20%20plot_weights()%0A%20%20%20%20%5D%2C%20justify%3D'center'%2C%20align%3D'center')%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">acf5cd4663b3048da1852a5cfbbed21e</marimo-code-hash>
</body>
</html>
